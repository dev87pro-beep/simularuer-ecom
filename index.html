<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Senix Flow | لوحة إدارة ذكية</title>
    <!-- مكتبة الأيقونات -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- خط عربي (Cairo) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. Design Tokens (Semantic Palette) --- */
        :root {
            /* الخلفيات */
            --bg-body: #f8fafc;       /* رمادي فاتح جداً */
            --bg-white: #ffffff;
            --bg-sidebar: #0f172a;    /* أسود كحلي عميق (لتباين مع الفضاء) */
            --bg-input: #f1f5f9;

            /* النصوص */
            --text-main: #334155;
            --text-muted: #64748b;
            --text-white: #f8fafc;
            --text-sidebar: #94a3b8;
            
            /* ألوان العلامة التجارية (Senix Flow Brand Colors) */
            --brand-primary: #6366f1;     /* لون بنفسجي هادئ لشعار Senix Flow */
            --brand-accent: #0ea5e9;      /* لون أزرق دينامي للسحب/التدفق */
            
            /* ألوان الأقسام الدلالية (Semantic) - محسنة */
            --color-dashboard: #6366f1;    /* بنفسجي */
            --color-inventory: #ea580c;    /* بني برتقالي */
            --color-shipping: #0284c7;    /* أزرق بحري */
            --color-winning: #d97706;       /* ذهبي */
            --color-pages: #8b5cf6;         /* بنفسجي */
            --color-calc: #059669;           /* أخضر زمردي */
            --color-danger: #ef4444;        /* أحمر */
            
            /* حدود وظلال */
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-brand: 0 4px 15px rgba(99, 102, 241, 0.2); /* ظل متوهج باللون البرند */
            
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
        }

        /* --- 2. Auth Screen --- */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%); /* تدرج لون داكن */
            z-index: 9999;
            display: none; /* يتم التحكم به عبر JS */
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 60px 40px;
            border-radius: 24px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            text-align: center;
        }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

        .brand-logo { font-size: 4rem; color: var(--brand-primary); margin-bottom: 10px; }
        .brand-title { font-size: 2rem; font-weight: 800; color: #0f172a; margin-bottom: 40px; letter-spacing: -1px; }
        
        .form-control { width: 100%; padding: 16px 20px; border: 2px solid var(--border); border-radius: 14px; font-size: 1.1rem; background: var(--bg-body); font-family: inherit; margin-bottom: 20px; transition: all 0.3s; }
        .form-control:focus { border-color: var(--brand-accent); background: #fff; box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.2); }
        
        .btn-auth { width: 100%; padding: 18px; background: var(--brand-primary); color: #fff; border: none; border-radius: 14px; font-size: 1.2rem; font-weight: 700; font-family: inherit; cursor: pointer; transition: all 0.3s; box-shadow: var(--shadow-brand); margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 12px; }
        .btn-auth:hover { transform: translateY(-2px); background: #4f46e5; box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3); }
        .btn-auth.secondary { background: transparent; color: var(--brand-primary); border: 2px solid var(--brand-primary); box-shadow: none; }
        .btn-auth.secondary:hover { background: rgba(99, 102, 241, 0.05); }

        .auth-msg { margin-bottom: 20px; color: var(--color-danger); font-size: 0.95rem; font-weight: 600; display: none; animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }

        /* --- 3. Sidebar --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            color: var(--text-white);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            right: 0;
            top: 0;
            z-index: 50;
            box-shadow: -10px 0 30px rgba(0,0,0,0.4); /* ظل قوي للبرانز */
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-header {
            padding: 40px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 0%, transparent 100%);
        }
        
        /* Logo styling for Senix Flow */
        .sidebar-logo-area { display: flex; align-items: center; gap: 15px; flex: 1; }
        .sidebar-logo-icon { font-size: 2.2rem; color: var(--brand-accent); filter: drop-shadow(0 0 5px rgba(14, 165, 233, 0.5)); /* توهج */
        }
        .sidebar-brand-name { font-size: 1.5rem; font-weight: 800; color: var(--text-white); letter-spacing: 0.5px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        .nav-links { list-style: none; padding: 30px 0; flex-grow: 1; }
        .nav-links li { margin-bottom: 8px; }
        
        .nav-links a {
            display: flex;
            align-items: center;
            padding: 18px 25px;
            color: var(--text-sidebar);
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 14px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-links a:hover {
            background-color: rgba(255,255,255,0.08);
            color: var(--text-white);
            transform: translateX(-8px);
        }

        .nav-links a.active {
            background: linear-gradient(90deg, var(--brand-primary) 0%, rgba(99, 102, 241, 0.8) 100%);
            color: var(--text-white);
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        /* تأثير زخرفة (Shine) للعنصر النشط */
        .nav-links a.active::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); animation: shine 2s infinite;
        }
        @keyframes shine { 0% { left: -100%; } 100% { left: 100%; } }

        .nav-links a i { margin-left: 20px; width: 24px; text-align: center; font-size: 1.25rem; }

        /* --- 4. Main Content --- */
        .main-content {
            margin-right: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            padding: 45px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
        }

        /* --- 5. Header --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 40px; background: var(--bg-white); padding: 25px 35px; border-radius: 20px;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border);
            position: sticky; top: 25px; z-index: 40;
        }
        .page-title { font-size: 2rem; font-weight: 800; color: var(--brand-primary); letter-spacing: -0.5px; display: flex; align-items: center; gap: 15px; }
        .toggle-menu { display: none; font-size: 1.6rem; color: var(--text-muted); cursor: pointer; padding: 10px; border-radius: 50%; transition: 0.2s; }
        .toggle-menu:hover { background: #f1f5f9; color: var(--brand-primary); }

        /* --- 6. Sections --- */
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 7. Dashboard Grid --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 30px; grid-auto-rows: min-content; }

        /* --- 8. KPI Cards --- */
        .kpi-section { grid-column: span 12; display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 25px; }
        .kpi-card {
            background: var(--bg-white); padding: 35px; border-radius: 20px;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            position: relative; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }
        .kpi-card::after { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--brand-primary); transform: scaleY(0); transition: transform 0.3s; }
        .kpi-card:hover { transform: translateY(-10px); box-shadow: var(--shadow-lg); border-color: transparent; }
        .kpi-card:hover::after { transform: scaleY(1); }

        .kpi-info h4 { font-size: 0.9rem; color: var(--text-muted); font-weight: 700; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .kpi-info p { font-size: 2.2rem; font-weight: 800; color: var(--brand-primary); }
        .kpi-icon { font-size: 2.2rem; opacity: 0.05; transition: 0.3s; }
        .kpi-card:hover .kpi-icon { opacity: 0.15; }

        /* --- 9. Action Cards --- */
        .actions-section { grid-column: span 12; margin-bottom: 30px; }
        .actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 25px; }
        
        .action-card {
            background: var(--bg-white); padding: 25px; border-radius: 20px;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; overflow: hidden;
        }
        .action-card::before { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 4px; background: var(--brand-accent); transform: scaleX(0); transition: transform 0.3s; }
        .action-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .action-card:hover::before { transform: scaleX(1); }
        
        .action-card i { font-size: 2rem; color: var(--text-muted); margin-bottom: 12px; transition: 0.3s; }
        .action-card:hover i { color: var(--brand-primary); transform: scale(1.1); }
        .action-card span { font-weight: 700; font-size: 1.1rem; color: var(--text-main); position: relative; z-index: 1; }

        /* --- 10. Lists (Winning, Weak, Pages) --- */
        .card-wrapper { background: var(--bg-white); border-radius: 20px; box-shadow: var(--shadow-sm); padding: 35px; border: 1px solid var(--border); height: 100%; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #f1f5f9; padding-bottom: 20px; }
        .card-header h3 { font-size: 1.3rem; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 15px; }
        
        .top-list { display: flex; flex-direction: column; gap: 20px; }
        .top-item {
            display: flex; align-items: center; justify-content: space-between;
            background: #f8fafc; padding: 20px 25px; border-radius: 18px;
            transition: all 0.3s; border: 1px solid transparent;
        }
        .top-item:hover { background: #fff; box-shadow: var(--shadow-md); border-right: 4px solid var(--color-winning); transform: translateX(-5px); }
        
        .item-info { display: flex; align-items: center; gap: 20px; flex-grow: 1; }
        .item-img { width: 70px; height: 70px; border-radius: 16px; object-fit: cover; border: 1px solid #e2e8f0; }
        .item-name { font-weight: 700; font-size: 1.2rem; color: var(--text-main); }
        .item-sub { font-size: 0.95rem; color: var(--text-muted); }
        
        .item-metrics { display: flex; align-items: center; gap: 15px; }
        .metric-badge { background: #fffbeb; color: #b45309; padding: 8px 18px; border-radius: 25px; font-weight: 700; font-size: 0.95rem; }
        
        .btn-icon { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 14px; border: none; cursor: pointer; transition: 0.2s; color: white; }
        .btn-icon:hover { transform: scale(1.1); }

        /* Weak & Sections */
        .weak-row { display: flex; justify-content: space-between; padding: 15px 25px; background: #fff1f2; border-radius: 16px; margin-bottom: 15px; font-size: 1rem; align-items: center; border: 1px solid transparent; transition: 0.3s; }
        .weak-row:hover { background: #fff; box-shadow: var(--shadow-sm); border-color: var(--color-danger); transform: translateX(-5px); }
        .weak-row strong { font-weight: 700; color: var(--text-main); flex: 1; }
        .weak-row span { font-weight: 800; color: var(--color-danger); }

        .page-link { display: flex; justify-content: space-between; padding: 18px 25px; background: #f8fafc; border-radius: 16px; text-decoration: none; font-weight: 700; margin-bottom: 15px; border: 1px solid transparent; align-items: center; color: var(--text-main); transition: 0.3s; }
        .page-link:hover { background: #fff; box-shadow: var(--shadow-sm); border-color: var(--color-pages); transform: translateX(-5px); color: var(--color-pages); }

        /* --- 11. Full Lists --- */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .product-card {
            background: var(--bg-white); border-radius: 20px; overflow: hidden;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative;
        }
        .product-card::before { content: ''; position: absolute; bottom: 0; left: 0; width: 4px; height: 100%; background: var(--brand-primary); transform: scaleY(0); transition: transform 0.3s; }
        .product-card:hover { transform: translateY(-10px); box-shadow: var(--shadow-lg); }
        .product-card:hover::before { transform: scaleY(1); }

        .product-img { width: 100%; height: 200px; object-fit: cover; border-bottom: 1px solid #f1f5f9; background-color: #f1f5f9; }
        .product-body { padding: 30px; }
        .product-title { font-weight: 700; font-size: 1.3rem; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 15px; }
        .product-meta { font-size: 1rem; color: var(--text-muted); margin-bottom: 10px; display: flex; justify-content: space-between; }
        .product-actions { padding: 20px 30px; border-top: 1px solid #f1f5f9; display: flex; justify-content: flex-end; gap: 15px; }
        .badge { padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; }
        .badge-success { background: #d1fae5; color: #047857; }
        .badge-warning { background: #ffedd5; color: #b45309; }
        .badge-danger { background: #fee2e2; color: #b91c1c; }
        
        .btn-sm { width: 40px; height: 40px; border-radius: 12px; border: none; cursor: pointer; transition: 0.2s; color: white; display: flex; align-items: center; justify-content: center; }
        .btn-sm:hover { transform: scale(1.1); }

        /* --- 12. Calculator --- */
        .calc-wrapper { background: var(--bg-white); padding: 60px; border-radius: 24px; box-shadow: var(--shadow-sm); border: 1px solid var(--border); max-width: 1100px; margin: 0 auto; border-bottom: 6px solid var(--brand-primary); }
        .calc-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; }
        .calc-group { margin-bottom: 35px; position: relative; }
        .calc-group label { display: block; margin-bottom: 12px; font-weight: 600; color: var(--text-main); font-size: 1.1rem; }
        .calc-group i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--brand-accent); font-size: 1.3rem; }
        .calc-control { width: 100%; padding: 16px 20px 16px 50px; border: 1px solid var(--border); border-radius: 12px; font-family: inherit; font-size: 1.1rem; background: var(--bg-input); transition: 0.3s; }
        .calc-control:focus { border-color: var(--brand-accent); background: #fff; box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.2); }
        .calc-res { margin-top: 50px; padding: 30px; background: #f8fafc; border-radius: 18px; border: 2px dashed #cbd5e1; display: flex; justify-content: space-around; text-align: center; }
        .res-box { flex: 1; }
        .res-box span { font-size: 2.2rem; font-weight: 800; color: var(--text-main); }

        /* --- 13. Modal --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.85); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; transition: opacity 0.3s; backdrop-filter: blur(8px); }
        .modal.open { display: flex; opacity: 1; }
        .modal-content { background: var(--bg-white); padding: 45px; border-radius: 24px; width: 100%; max-width: 650px; position: relative; transform: scale(0.95); transition: transform 0.3s; box-shadow: 0 25px 50px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto; }
        .modal.open .modal-content { transform: scale(1); }
        .close-modal { position: absolute; left: 30px; top: 30px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 50%; color: var(--text-muted); font-size: 1.8rem; cursor: pointer; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .close-modal:hover { background: #fee2e2; color: var(--color-danger); }
        
        .form-group { margin-bottom: 30px; }
        .form-label { display: block; margin-bottom: 10px; font-weight: 600; color: var(--text-main); font-size: 1.1rem; }
        .form-input { width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 12px; font-family: inherit; font-size: 1.1rem; background: var(--bg-input); transition: 0.3s; }
        .form-input:focus { border-color: var(--brand-primary); background: #fff; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .btn-full { width: 100%; padding: 16px; background: var(--brand-primary); color: #fff; border: none; border-radius: 12px; font-family: inherit; font-weight: 700; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: var(--shadow-brand); }
        .btn-full:hover { transform: translateY(-2px); background: #4f46e5; }

        /* --- 14. Toast --- */
        .toast-container { position: fixed; bottom: 30px; left: 30px; z-index: 2000; display: flex; flex-direction: column; gap: 12px; }
        .toast { background: var(--brand-primary); color: white; padding: 18px 30px; border-radius: 12px; box-shadow: 0 10px 15px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 15px; min-width: 300px; border-right: 6px solid var(--brand-accent); animation: slideInRight 0.5s; }
        @keyframes slideInRight { from { transform: translateX(-50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- 15. Responsive --- */
        @media (max-width: 1024px) {
            .dashboard-grid > div { grid-column: span 12; }
            .winning-section, .weak-section, .pages-section { grid-column: span 12; display: flex; flex-direction: column; gap: 20px; margin-top: 20px; }
            .calc-inputs { grid-template-columns: 1fr !important; }
        }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-right: 0 !important; width: 100% !important; padding: 25px; }
            .toggle-menu { display: block !important; }
            header { padding: 20px 25px; top: 10px; }
            .page-title { font-size: 1.6rem; }
            .kpi-section { grid-template-columns: 1fr !important; gap: 15px; }
            .actions-grid { grid-template-columns: 1fr 1fr !important; gap: 15px; }
            .calc-wrapper { padding: 40px; }
            .modal-content { width: 95%; }
        }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div style="width: 60px; height: 60px; border: 4px solid var(--brand-accent); border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 25px; font-weight: 700; color: var(--brand-primary); letter-spacing: 1px;">جاري الاتصال بـ Senix Flow...</p>
    </div>
    <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>

    <!-- Auth Screen -->
    <div id="auth-screen">
        <div class="auth-container">
            <!-- Cloud Icon for Flow -->
            <div class="brand-logo"><i class="fas fa-cloud"></i></div>
            <h1 class="brand-title">Senix Flow</h1>
            
            <div id="auth-msg" class="auth-msg"></div>
            <input type="email" id="auth-email" class="form-control" placeholder="البريد الإلكتروني">
            <input type="password" id="auth-password" class="form-control" placeholder="كلمة المرور">
            <button class="btn-auth" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> دخول إلى الفضاء
            </button>
            <button class="btn-auth secondary" onclick="register()">
                <i class="fas fa-rocket"></i> حساب جديد
            </button>
            <div style="margin-top: 25px; font-size: 0.85rem; color: var(--text-muted); border-top: 1px dashed var(--border); padding-top: 15px;">
                حساب تجريبي:<br>
                Email: admin@senix.com<br>
                Pass: 123456
            </div>
        </div>
    </div>

    <!-- Main App (Hidden until login) -->
    <div id="app" style="display: none; opacity: 0; transition: opacity 0.5s;">
        
        <!-- Sidebar with Senix Flow Branding -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo-area">
                    <!-- Cloud Icon with Glow -->
                    <i class="fas fa-cloud sidebar-logo-icon"></i>
                    <h2 class="sidebar-brand-name">Senix Flow</h2>
                </div>
            </div>
            <ul class="nav-links">
                <li><a href="#" onclick="switchTab('dashboard')" class="active"><i class="fas fa-th-large"></i> الرئيسية</a></li>
                <li><a href="#" onclick="switchTab('inventory')"><i class="fas fa-boxes"></i> المخزون</a></li>
                <li><a href="#" onclick="switchTab('importing')"><i class="fas fa-shipping-fast"></i> الاستيراد</a></li>
                <li><a href="#" onclick="switchTab('winning')"><i class="fas fa-trophy"></i> الرابحة</a></li>
                <li><a href="#" onclick="switchTab('pages')"><i class="fas fa-store"></i> الصفحات</a></li>
                <li><a href="#" onclick="switchTab('calculator')"><i class="fas fa-calculator"></i> الحاسبة</a></li>
            </ul>
            <div style="margin-top: auto; padding: 20px 30px; border-top: 1px solid rgba(255,255,255,0.05);">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                    <i class="fas fa-user-circle" style="color: var(--text-sidebar); font-size: 1.5rem;"></i>
                    <div style="color: #cbd5e1; font-size: 0.9rem; width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">المسؤول</div>
                </div>
                <button onclick="logout()" style="width: 100%; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #f87171; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas fa-sign-out-alt"></i> تسجيل خروج
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header>
                <div style="display:flex; align-items:center;">
                    <i class="fas fa-bars toggle-menu" onclick="toggleSidebar()"></i>
                    <h1 class="page-title">
                        <i class="fas fa-bolt" style="color: var(--brand-accent); font-size: 1.5rem;"></i> Senix Flow
                    </h1>
                </div>
            </header>

            <!-- 1. DASHBOARD -->
            <section id="dashboard" class="section active">
                <div class="dashboard-grid">
                    
                    <!-- KPI Cards -->
                    <div class="kpi-section">
                        <div class="kpi-card">
                            <div class="kpi-info"><h4>عدد المنتجات</h4><p id="kpi-total">0</p></div>
                            <i class="fas fa-layer-group kpi-icon" style="color: var(--color-dashboard);"></i>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-info"><h4>الرابحة (Valid)</h4><p id="kpi-winning">0</p></div>
                            <i class="fas fa-trophy kpi-icon" style="color: var(--color-winning);"></i>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-info"><h4>الاستيراد</h4><p id="kpi-importing">0</p></div>
                            <i class="fas fa-rocket kpi-icon" style="color: var(--color-shipping);"></i>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-info"><h4>رأس المال</h4><p id="kpi-capital">0 <span style="font-size:1.2rem; font-weight:400;">MAD</span></p></div>
                            <i class="fas fa-coins kpi-icon" style="color: var(--color-winning);"></i>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-info"><h4>الربح المتوقع</h4><p id="kpi-profit">0 <span style="font-size:1.2rem; font-weight:400;">MAD</span></p></div>
                            <i class="fas fa-chart-line kpi-icon" style="color: var(--color-calc);"></i>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="actions-section">
                        <div class="actions-grid">
                            <div class="action-card" onclick="openModal('inventory')">
                                <i class="fas fa-plus-circle"></i> <span>منتج مخزون</span>
                            </div>
                            <div class="action-card" onclick="openModal('winning')">
                                <i class="fas fa-trophy"></i> <span>منتج رابح</span>
                            </div>
                            <div class="action-card" onclick="openModal('importing')">
                                <i class="fas fa-shipping-fast"></i> <span>استيراد</span>
                            </div>
                            <div class="action-card" onclick="openModal('pages')">
                                <i class="fas fa-store"></i> <span>صفحة ناجحة</span>
                            </div>
                        </div>
                    </div>

                    <!-- Cards -->
                    <div class="card-wrapper" style="grid-column: span 8;">
                        <div class="card-header">
                            <h3><i class="fas fa-crown" style="color: var(--color-winning);"></i> قمة المنتجات الرابحة</h3>
                        </div>
                        <div class="top-list" id="top-winning-list"></div>
                    </div>

                    <div class="card-wrapper weak-section" style="grid-column: span 4;">
                        <div class="card-header"><h3><i class="fas fa-exclamation-triangle" style="color: var(--color-danger);"></i> تنبيهات</h3></div>
                        <div id="weak-alert-container"></div>
                    </div>

                    <div class="card-wrapper pages-section" style="grid-column: span 8;">
                        <div class="card-header"><h3><i class="fas fa-link" style="color: var(--color-pages);"></i> أفضل الصفحات</h3></div>
                        <div id="best-pages-list"></div>
                    </div>

                </div>
            </section>

            <!-- OTHER SECTIONS -->
            <section id="inventory" class="section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                    <h2 style="font-size:1.8rem; font-weight:800;">المخزون</h2>
                    <button class="btn-full" style="width: auto; background: var(--color-inventory);" onclick="openModal('inventory')"><i class="fas fa-plus"></i> إضافة منتج</button>
                </div>
                <div id="inventory-list" class="card-grid"></div>
            </section>

            <section id="importing" class="section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                    <h2 style="font-size:1.8rem; font-weight:800;">الاستيراد</h2>
                    <button class="btn-full" style="width: auto; background: var(--color-shipping);" onclick="openModal('importing')"><i class="fas fa-plus"></i> إضافة منتج</button>
                </div>
                <div id="importing-list" class="card-grid"></div>
            </section>

            <section id="winning" class="section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                    <h2 style="font-size:1.8rem; font-weight:800;">المنتجات الرابحة</h2>
                    <button class="btn-full" style="width: auto; background: var(--color-winning);" onclick="openModal('winning')"><i class="fas fa-plus"></i> إضافة منتج رابح</button>
                </div>
                <div id="winning-list" class="card-grid"></div>
            </section>

            <section id="pages" class="section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                    <h2 style="font-size:1.8rem; font-weight:800;">أفضل الصفحات</h2>
                    <button class="btn-full" style="width: auto; background: var(--color-pages);" onclick="openModal('pages')"><i class="fas fa-plus"></i> إضافة صفحة</button>
                </div>
                <div id="pages-list" class="card-grid"></div>
            </section>

            <section id="calculator" class="section">
                <div style="text-align:center; margin-bottom:40px;">
                    <h2 style="font-size:1.8rem; font-weight:800;">حاسبة السرعة (Flow Calc)</h2>
                </div>
                <div class="calc-wrapper">
                    <div class="calc-inputs">
                        <div class="calc-group">
                            <label>ثمن الشراء (MAD)</label>
                            <input type="number" id="calc-buy-price" class="calc-control" placeholder="0.00" oninput="calculateProfit()">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="calc-group">
                            <label>التوصيل (MAD)</label>
                            <input type="number" id="calc-delivery" class="calc-control" placeholder="0.00" oninput="calculateProfit()">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="calc-group">
                            <label>الإعلانات (MAD)</label>
                            <input type="number" id="calc-ads" class="calc-control" placeholder="0.00" oninput="calculateProfit()">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <div class="calc-group">
                            <label>هامش الربح (MAD)</label>
                            <input type="number" id="calc-margin" class="calc-control" placeholder="0.00" oninput="calculateProfit()">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                    </div>
                    
                    <div class="calc-res">
                        <div class="res-box">
                            <span id="res-sale">0 <span>MAD</span></span>
                        </div>
                        <div class="res-box">
                            <span id="res-net">0 <span>MAD</span></span>
                        </div>
                        <div class="res-box">
                            <span id="res-usd" style="font-size: 1.5rem; color: var(--text-muted);">$0.00</span>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <!-- MODAL -->
        <div class="modal" id="modal-overlay">
            <div class="modal-content">
                <button class="close-modal" onclick="closeModal()"><i class="fas fa-times"></i></button>
                <h2 style="margin-bottom: 40px; font-weight: 700; color: var(--text-main); text-align: center;" id="modal-title">عنوان النافذة</h2>
                <div id="modal-form-body"></div>
            </div>
        </div>

        <div class="toast-container" id="toast-container"></div>
    </div>

    <!-- FIREBASE SDK -->
    <script type="module">
        // --- 1. Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";

        // --- 2. Config ---
const firebaseConfig = {
  apiKey: "AIzaSyDOfw9W2U1o5HGjtcUfnQhjudoQnqFccBk",
  authDomain: "my-store-app-12651.firebaseapp.com",
  projectId: "my-store-app-12651",
  storageBucket: "my-store-app-12651.firebasestorage.app",
  messagingSenderId: "52453040648",
  appId: "1:52453040648:web:a8101a86e030c559f967bd"
};

        // --- 3. Init ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- 4. Global Scope ---
        window.app = app;
        window.auth = auth;
        window.db = db;
        window.collection = collection;
        window.doc = doc;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;

        // --- 5. State ---
        const USD_RATE = 9;
        const WEAK_THRESHOLD = 20;
        let dbData = { inventory: [], importing: [], winning: [], pages: [] };

        // --- 6. Auth ---
        onAuthStateChanged(auth, (user) => {
            const loading = document.getElementById('loading-screen');
            const authScreen = document.getElementById('auth-screen');
            const mainApp = document.getElementById('app');

            if (user) {
                loading.style.display = 'none';
                authScreen.style.display = 'none';
                mainApp.style.display = 'block';
                setTimeout(() => mainApp.style.opacity = '1', 50);
                loadDashboardData();
            } else {
                loading.style.display = 'none';
                authScreen.style.display = 'flex';
                mainApp.style.display = 'none';
                mainApp.style.opacity = '0';
            }
        });

        window.login = async () => {
            const e = document.getElementById('auth-email').value;
            const p = document.getElementById('auth-password').value;
            if(!e || !p) { showAuthMsg('يرجى ملء الحقول'); return; }
            try { await signInWithEmailAndPassword(auth, e, p); }
            catch(err) { showAuthMsg('خطأ في البيانات'); }
        };

        window.register = async () => {
            const e = document.getElementById('auth-email').value;
            const p = document.getElementById('auth-password').value;
            if(!e || !p) { showAuthMsg('يرجى ملء الحقول'); return; }
            try { await createUserWithEmailAndPassword(auth, e, p); }
            catch(err) { showAuthMsg('البريد مستخدم مسبقاً'); }
        };

        window.logout = () => signOut(auth).then(() => window.location.reload());
        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');

        function showAuthMsg(text) {
            const el = document.getElementById('auth-msg');
            el.innerText = text;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // --- 7. Data Loader ---
        async function loadDashboardData() {
            const inv = await getDocs(collection(db, 'inventory'));
            dbData.inventory = inv.docs.map(d => ({ id: d.id, ...d.data() }));

            const imp = await getDocs(collection(db, 'importing'));
            dbData.importing = imp.docs.map(d => ({ id: d.id, ...d.data() }));

            const win = await getDocs(collection(db, 'winning'));
            dbData.winning = win.docs.map(d => ({ id: d.id, ...d.data() }));

            const pag = await getDocs(collection(db, 'pages'));
            dbData.pages = pag.docs.map(d => ({ id: d.id, ...d.data() }));

            renderApp(dbData);
        }

        // --- 8. Render (Maintains logic, just adds branding) ---
        function renderApp(data) {
            document.getElementById('kpi-total').innerText = data.inventory.length + data.importing.length + data.winning.length;
            document.getElementById('kpi-winning').innerText = data.winning.filter(w => w.status === 'valid').length;
            document.getElementById('kpi-importing').innerText = data.importing.length;
            
            let capital = 0, profit = 0;
            data.inventory.forEach(p => capital += (p.price * p.quantity));
            data.importing.forEach(p => capital += (p.price * p.quantity));
            data.winning.forEach(p => { capital += (p.buyPrice * p.quantity); profit += (p.margin * p.quantity); });
            
            document.getElementById('kpi-capital').innerHTML = `${capital.toLocaleString()} <span style="font-size:1.2rem; font-weight:400; color: #64748b;">MAD</span>`;
            document.getElementById('kpi-profit').innerHTML = `${profit.toLocaleString()} <span style="font-size:1.2rem; font-weight:400; color: #64748b;">MAD</span>`;

            // Top Winning
            const list = document.getElementById('top-winning-list');
            list.innerHTML = '';
            const sorted = [...data.winning].filter(p => p.status === 'valid').sort((a,b) => b.margin - a.margin).slice(0, 5);
            if(sorted.length === 0) list.innerHTML = '<div class="weak-row" style="text-align:center; color:#cbd5e1;">لا توجد منتجات رابحة</div>';
            else sorted.forEach(p => {
                list.innerHTML += `
                    <div class="top-item">
                        <div class="item-info">
                            <img src="${p.image || 'https://via.placeholder.com/70'}" class="item-img">
                            <div>
                                <div class="item-name">${p.name}</div>
                                <div class="item-sub">${p.salePrice} MAD</div>
                            </div>
                        </div>
                        <div class="item-metrics">
                            <span class="metric-badge">+${p.margin} MAD</span>
                            <button class="btn-icon" style="background:var(--color-calc);" onclick="toggleStatus('${p.id}')"><i class="fas fa-check"></i></button>
                            <button class="btn-icon" style="background:var(--color-danger);" onclick="deleteItem('winning', '${p.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });

            // Weak
            const weak = document.getElementById('weak-alert-container');
            weak.innerHTML = '';
            const weakItems = data.winning.filter(p => p.status === 'valid' && p.margin < WEAK_THRESHOLD);
            if(weakItems.length === 0) weak.innerHTML = '<div class="weak-row" style="justify-content:center; color:var(--color-calc);">المنتجات قوية</div>';
            else weakItems.forEach(p => {
                weak.innerHTML += `<div class="weak-row"><strong>${p.name}</strong> <span>${p.margin} MAD</span></div>`;
            });

            // Pages
            const pages = document.getElementById('best-pages-list');
            pages.innerHTML = '';
            if(data.pages.length === 0) pages.innerHTML = '<div class="weak-row" style="text-align:center;">لا توجد صفحات</div>';
            else data.pages.forEach(p => {
                pages.innerHTML += `<a href="${p.link}" target="_blank" class="page-link"><span>${p.name}</span> <i class="fas fa-external-link-alt"></i></a>`;
            });
        }

        // --- 9. Navigation ---
        window.switchTab = (id) => {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            if(id === 'dashboard') loadDashboardData();
            else if(id === 'inventory') renderList('inventory');
            else if(id === 'importing') renderList('importing');
            else if(id === 'winning') renderList('winning');
            else if(id === 'pages') renderList('pages');
            
            if(window.innerWidth <= 768) window.toggleSidebar();
        };

        // --- 10. List Renderer ---
        function renderList(type) {
            const container = document.getElementById(type + '-list');
            container.innerHTML = '';
            const items = dbData[type];
            
            if(items.length === 0) {
                container.innerHTML = `<div style="text-align:center; padding:50px; color:#cbd5e1; background:#f8fafc; border-radius:16px; border:2px dashed var(--border); grid-column: 1 / -1;">لا توجد بيانات</div>`;
                return;
            }

            items.forEach(item => {
                const isAvailable = type === 'inventory' ? item.quantity > 0 : false;
                const badge = isAvailable ? '<span class="badge badge-success">متوفر</span>' : '<span class="badge badge-danger">نفذت</span>';
                let statusHtml = type === 'winning' ? (item.status === 'valid' ? '<span class="badge badge-success">Valid</span>' : '<span class="badge badge-danger">Invalid</span>') : '';
                
                let links = type === 'winning' ? 
                    `<div style="margin-top:12px; display:flex; gap:10px;">
                        ${item.alibaba ? `<a href="${item.alibaba}" target="_blank" style="color:var(--color-shipping); font-weight:600;"><i class="fas fa-link"></i></a>` : ''}
                        ${item.store ? `<a href="${item.store}" target="_blank" style="color:var(--brand-primary); font-weight:600;"><i class="fas fa-link"></i></a>` : ''}
                    </div>` : '';

                const priceMeta = type === 'winning' ? `شراء: ${item.buyPrice} | بيع: ${item.salePrice}` : `السعر: ${item.price} MAD`;
                const valMeta = type === 'winning' ? `الربح: ${item.margin} MAD` : `الكمية: ${item.quantity}`;

                container.innerHTML += `
                    <div class="product-card">
                        <img src="${item.image || 'https://via.placeholder.com/300x200?text=No+Image'}" class="product-img">
                        <div class="product-body">
                            <div class="product-title">${item.name}</div>
                            <div class="product-meta">${priceMeta}</div>
                            <div class="product-meta">${valMeta}</div>
                            ${links}
                            ${badge}
                        </div>
                        <div class="product-actions">
                            <button class="btn-sm" style="background:var(--color-dashboard);" onclick="openModal('${type}', '${item.id}')"><i class="fas fa-eye"></i></button>
                            <button class="btn-sm" style="background:var(--color-inventory);" onclick="openModal('${type}', '${item.id}')"><i class="fas fa-edit"></i></button>
                            <button class="btn-sm" style="background:var(--color-danger);" onclick="deleteItem('${type}', '${item.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });
        }

        // --- 11. Calculator ---
        window.calculateProfit = () => {
            const buy = parseFloat(document.getElementById('calc-buy-price').value) || 0;
            const ship = parseFloat(document.getElementById('calc-delivery').value) || 0;
            const ads = parseFloat(document.getElementById('calc-ads').value) || 0;
            const margin = parseFloat(document.getElementById('calc-margin').value) || 0;
            const sale = buy + ship + ads + margin;
            const usd = sale / USD_RATE;
            document.getElementById('res-sale').innerHTML = `${sale.toFixed(2)} <span>MAD</span>`;
            document.getElementById('res-net').innerHTML = `${margin.toFixed(2)} <span>MAD</span>`;
            document.getElementById('res-usd').innerText = `$${usd.toFixed(2)}`;
        };

        // --- 12. Modal ---
        let currentType = '', editingId = null, tempImage = '';
        window.openModal = (type, id = null) => {
            currentType = type; editingId = id; tempImage = '';
            const modal = document.getElementById('modal-overlay');
            const body = document.getElementById('modal-form-body');
            const title = document.getElementById('modal-title');
            modal.classList.add('open'); body.innerHTML = '';
            
            let data = {};
            if(id) {
                if(type === 'inventory') data = dbData.inventory.find(i => i.id === id);
                else if(type === 'importing') data = dbData.importing.find(i => i.id === id);
                else if(type === 'winning') data = dbData.winning.find(i => i.id === id);
                else if(type === 'pages') data = dbData.pages.find(i => i.id === id);
                tempImage = data.image || '';
            }
            
            title.innerText = id ? 'تعديل ' + getTitle(type) : 'إضافة ' + getTitle(type);
            
            const imgPreview = `
                <div style="width:100%; height:150px; background:var(--bg-input); border:2px dashed #cbd5e1; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:25px; cursor:pointer;" onclick="document.getElementById('file-upload').click()">
                    ${tempImage ? `<img src="${tempImage}" style="width:100%; height:100%; object-fit:cover; border-radius:10px;">` : '<span style="color:#94a3b8;"><i class="fas fa-camera fa-2x"></i><br>اضغط لرفع</span>'}
                </div>
                <input type="file" id="file-upload" style="display:none" accept="image/*" onchange="handleImageUpload(this)">
            `;

            let html = '';
            if(type === 'inventory') {
                html = imgPreview + `
                    <div class="form-group"><label>اسم المنتج</label><input type="text" id="inp-name" class="form-input" value="${data.name || ''}"></div>
                    <div class="form-group"><label>الكمية</label><input type="number" id="inp-qty" class="form-input" value="${data.quantity || 0}"></div>
                    <div class="form-group"><label>السعر</label><input type="number" id="inp-price" class="form-input" value="${data.price || 0}"></div>
                    <button class="btn-full" onclick="saveItem()">حفظ المنتج</button>
                `;
            } else if(type === 'importing') {
                html = imgPreview + `
                    <div class="form-group"><label>اسم المنتج</label><input type="text" id="inp-name" class="form-input" value="${data.name || ''}"></div>
                    <div class="form-group"><label>الكمية</label><input type="number" id="inp-qty" class="form-input" value="${data.quantity || 0}"></div>
                    <div class="form-group"><label>السعر</label><input type="number" id="inp-price" class="form-input" value="${data.price || 0}"></div>
                    <div class="form-group"><label>ملاحظات</label><input type="text" id="inp-notes" class="form-input" value="${data.notes || ''}"></div>
                    <button class="btn-full" onclick="saveItem()">حفظ الاستيراد</button>
                `;
            } else if(type === 'winning') {
                html = imgPreview + `
                    <div class="form-group"><label>اسم المنتج</label><input type="text" id="inp-name" class="form-input" value="${data.name || ''}"></div>
                    <div class="form-group"><label>سعر الشراء</label><input type="number" id="inp-buy" class="form-input" value="${data.buyPrice || 0}"></div>
                    <div class="form-group"><label>سعر البيع</label><input type="number" id="inp-sale" class="form-input" value="${data.salePrice || 0}"></div>
                    <div class="form-group"><label>هامش الربح</label><input type="number" id="inp-margin" class="form-input" value="${data.margin || ''}"></div>
                    <div class="form-group"><label>الرابط</label><input type="text" id="inp-store" class="form-input" value="${data.store || ''}"></div>
                    <div class="form-group"><label>الحالة</label>
                        <select id="inp-status" class="form-input">
                            <option value="valid" ${data.status === 'valid' ? 'selected' : ''}>Valid</option>
                            <option value="invalid" ${data.status === 'invalid' ? 'selected' : ''}>Invalid</option>
                        </select>
                    </div>
                    <button class="btn-full" onclick="saveItem()">حفظ المنتج الرابح</button>
                `;
            } else if(type === 'pages') {
                html = `
                    <div class="form-group"><label>اسم الصفحة</label><input type="text" id="inp-name" class="form-input" value="${data.name || ''}"></div>
                    <div class="form-group"><label>الرابط</label><input type="text" id="inp-link" class="form-input" value="${data.link || ''}"></div>
                    <button class="btn-full" onclick="saveItem()">حفظ الصفحة</button>
                `;
            }
            body.innerHTML = html;
        };

        function getTitle(t) {
            if(t === 'inventory') return 'منتج مخزون';
            if(t === 'importing') return 'استيراد';
            if(t === 'winning') return 'منتج رابح';
            if(t === 'pages') return 'صفحة';
        }

        window.closeModal = () => document.getElementById('modal-overlay').classList.remove('open');
        window.handleImageUpload = (input) => {
            if(input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => { tempImage = e.target.result; input.previousElementSibling.innerHTML = `<img src="${tempImage}" style="width:100%; height:100%; object-fit:cover; border-radius:10px;">`; }
                reader.readAsDataURL(input.files[0]);
            }
        };

        // --- 13. Save Logic ---
        window.saveItem = async () => {
            const name = document.getElementById('inp-name').value;
            if(!name) { alert('الاسم مطلوب'); return; }

            let payload = { name, image: tempImage, createdAt: new Date() };
            
            if(currentType === 'inventory') {
                payload.quantity = parseInt(document.getElementById('inp-qty').value);
                payload.price = parseFloat(document.getElementById('inp-price').value);
                const ref = editingId ? doc(db, 'inventory', editingId) : doc(db, 'inventory', Date.now().toString());
            } else if(currentType === 'importing') {
                payload.quantity = parseInt(document.getElementById('inp-qty').value);
                payload.price = parseFloat(document.getElementById('inp-price').value);
                payload.notes = document.getElementById('inp-notes').value;
                const ref = editingId ? doc(db, 'importing', editingId) : doc(db, 'importing', Date.now().toString());
            } else if(currentType === 'winning') {
                payload.buyPrice = parseFloat(document.getElementById('inp-buy').value);
                payload.salePrice = parseFloat(document.getElementById('inp-sale').value);
                payload.margin = parseFloat(document.getElementById('inp-margin').value);
                payload.store = document.getElementById('inp-store').value;
                payload.status = document.getElementById('inp-status').value;
                const ref = editingId ? doc(db, 'winning', editingId) : doc(db, 'winning', Date.now().toString());
            } else if(currentType === 'pages') {
                payload.link = document.getElementById('inp-link').value;
                const ref = editingId ? doc(db, 'pages', editingId) : doc(db, 'pages', Date.now().toString());
            }

            if(editingId) {
                await updateDoc(ref, payload);
                showToast('تم التعديل بنجاح');
            } else {
                await addDoc(collection(db, currentType), payload);
                showToast('تمت الإضافة بنجاح');
            }
            
            closeModal();
            loadDashboardData();
        };

        window.deleteItem = async (type, id) => {
            if(confirm('هل أنت متأكد من الحذف؟')) {
                await deleteDoc(doc(db, type), id);
                loadDashboardData();
                showToast('تم الحذف بنجاح');
            }
        };

        window.toggleStatus = async (id) => {
            const item = dbData.winning.find(i => i.id === id);
            if(item) {
                const newStatus = item.status === 'valid' ? 'invalid' : 'valid';
                await updateDoc(doc(db, 'winning', id), { status: newStatus });
                loadDashboardData();
                showToast('تم تغيير الحالة');
            }
        };

        // --- 14. Helper ---
        function showToast(msg) {
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerHTML = `<i class="fas fa-check-circle" style="color:white;"></i> ${msg}`;
            document.getElementById('toast-container').appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>
</html>
