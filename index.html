<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم الشاملة - E-Commerce</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --border: #e2e8f0;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --radius: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Tajawal', sans-serif; }

        body { background-color: var(--bg-body); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        .sidebar {
            width: 260px; background: var(--bg-card); border-left: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 1.5rem; z-index: 20;
        }
        .brand { font-size: 1.2rem; font-weight: 800; color: var(--primary); margin-bottom: 2rem; display: flex; align-items: center; gap: 10px; }
        
        .nav-item {
            padding: 1rem; margin-bottom: 0.5rem; border-radius: var(--radius);
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px;
            font-weight: 500; color: var(--text-muted);
        }
        .nav-item:hover, .nav-item.active { background: #eff6ff; color: var(--primary); }
        .nav-item i { font-size: 1.2rem; }

        /* Main Content */
        .main-content { flex: 1; padding: 2rem; overflow-y: auto; position: relative; }
        
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .section-title h2 { font-size: 1.8rem; font-weight: 800; }
        .section-title p { color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; }

        /* Cards & Tables */
        .card { background: var(--bg-card); border-radius: var(--radius); padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 2rem; }
        
        .btn {
            padding: 0.6rem 1.2rem; border-radius: 8px; border: none; cursor: pointer;
            font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; font-size: 0.9rem;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .btn-block { width: 100%; justify-content: center; margin-top: 1rem; }

        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { text-align: right; padding: 1rem; background: #f1f5f9; color: var(--text-muted); font-size: 0.85rem; border-bottom: 2px solid var(--border); }
        .data-table td { padding: 1rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .data-table tr:hover { background: #f8fafc; }
        
        .actions { display: flex; gap: 8px; }

        /* Dashboard Widgets */
        .dashboard-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .quick-add-card {
            background: white; padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--border);
            display: flex; flex-direction: column; justify-content: space-between; height: 180px;
            transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;
        }
        .quick-add-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--primary); }
        
        .quick-icon { font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem; }
        .quick-title { font-size: 1.1rem; font-weight: 700; color: var(--text-main); }
        .quick-desc { font-size: 0.85rem; color: var(--text-muted); }

        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .form-group label { font-size: 0.85rem; font-weight: 600; color: var(--text-muted); }
        .form-control {
            padding: 0.7rem; border: 1px solid var(--border); border-radius: 8px;
            font-size: 0.95rem; transition: 0.2s; width: 100%;
        }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .form-control[readonly] { background: #f8fafc; color: var(--text-main); font-weight: 700; }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        .modal {
            background: white; padding: 2rem; border-radius: var(--radius); width: 550px; max-width: 90%;
            transform: translateY(20px); transition: 0.3s; max-height: 90vh; overflow-y: auto;
        }
        .modal-overlay.open .modal { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        .modal-footer { margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 10px; }

        /* Sections Visibility */
        .page-section { display: none; animation: fadeIn 0.3s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Floating Save Button */
        .save-fab {
            position: fixed; bottom: 30px; left: 30px; background: var(--text-main); color: white;
            padding: 1rem 1.5rem; border-radius: 50px; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: 700;
            transition: transform 0.2s; z-index: 900;
        }
        .save-fab:hover { transform: scale(1.05); background: black; }

        /* Utility */
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; }
        .badge-valid { background: #dcfce7; color: #166534; }
        .badge-invalid { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <i class="ri-dashboard-3-line"></i>
            <span>لوحة المتجر</span>
        </div>
        <nav>
            <div class="nav-item active" onclick="navTo('simulator')">
                <i class="ri-home-line"></i> الرئيسية (Dashboard)
            </div>
            <div class="nav-item" onclick="navTo('winning')">
                <i class="ri-trophy-line"></i> المنتجات الفائزة
            </div>
            <div class="nav-item" onclick="navTo('myproduct')">
                <i class="ri-store-3-line"></i> المخزون الحالي
            </div>
            <div class="nav-item" onclick="navTo('objectif')">
                <i class="ri-flag-2-line"></i> خطط الاستيراد
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- 1. DASHBOARD (Home) -->
        <section id="simulator" class="page-section active">
            <div class="section-header">
                <div class="section-title">
                    <h2>لوحة القيادة الرئيسية</h2>
                    <p>نظرة عامة سريعة والإضافة السريعة للبيانات.</p>
                </div>
            </div>

            <!-- Quick Add Cards -->
            <div class="dashboard-grid">
                <div class="quick-add-card" onclick="openWinningModal()">
                    <i class="ri-trophy-line quick-icon"></i>
                    <div>
                        <div class="quick-title">إضافة منتج فائز</div>
                        <div class="quick-desc">سجل منتجات Alibaba الجديدة مع حساب السعر.</div>
                    </div>
                </div>
                <div class="quick-add-card" onclick="openMyProductModal()">
                    <i class="ri-shopping-bag-3-line quick-icon"></i>
                    <div>
                        <div class="quick-title">إضافة مخزون</div>
                        <div class="quick-desc">تحديث الكميات المتوفرة في المستودع.</div>
                    </div>
                </div>
                <div class="quick-add-card" onclick="openObjectifModal()">
                    <i class="ri-ship-line quick-icon"></i>
                    <div>
                        <div class="quick-title">خطة استيراد</div>
                        <div class="quick-desc">إضافة أهداف استيراد وتخطيط الميزانية.</div>
                    </div>
                </div>
                <div class="quick-add-card" onclick="openSimModal()">
                    <i class="ri-settings-4-line quick-icon"></i>
                    <div>
                        <div class="quick-title">تعديل الإعدادات</div>
                        <div class="quick-desc">تحديث تكاليف الشحن والمصاريف العامة.</div>
                    </div>
                </div>
            </div>

            <!-- Simulator Status Card -->
            <div class="card">
                <div class="section-header" style="margin-bottom: 1rem;">
                    <h3><i class="ri-calculator-line" style="color:var(--primary)"></i> حالة الربحية الحالية (بناءً على الإعدادات)</h3>
                    <button class="btn btn-primary btn-sm" onclick="openSimModal()">تعديل</button>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="form-group">
                        <label>سعر الشراء (DH)</label>
                        <input type="text" class="form-control" id="sim-buy" readonly>
                    </div>
                    <div class="form-group">
                        <label>التكلفة الكلية (DH)</label>
                        <input type="text" class="form-control" id="sim-total-cost" readonly>
                    </div>
                    <div class="form-group">
                        <label>سعر البيع (DH)</label>
                        <input type="text" class="form-control" id="sim-sell" readonly style="font-weight: bold; color: var(--primary);">
                    </div>
                    <div class="form-group">
                        <label>هامش الربح (DH)</label>
                        <input type="text" class="form-control" id="sim-profit" readonly style="font-weight: bold; color: var(--success);">
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. WINNING PRODUCTS SECTION -->
        <section id="winning" class="page-section">
            <div class="section-header">
                <div class="section-title">
                    <h2>المنتجات الفائزة</h2>
                    <p>قاعدة بيانات المنتجات المرشحة للبيع.</p>
                </div>
                <button class="btn btn-primary" onclick="openWinningModal()">
                    <i class="ri-add-line"></i> إضافة منتج
                </button>
            </div>
            
            <div class="card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>اسم المنتج</th>
                            <th>شراء ($)</th>
                            <th>بيع ($)</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="winning-tbody"></tbody>
                </table>
            </div>
        </section>

        <!-- 3. MY PRODUCT SECTION -->
        <section id="myproduct" class="page-section">
            <div class="section-header">
                <div class="section-title">
                    <h2>مخزوني الحالي</h2>
                    <p>المنتجات المتوفرة والمباعة حالياً.</p>
                </div>
                <button class="btn btn-primary" onclick="openMyProductModal()">
                    <i class="ri-add-line"></i> إضافة مخزون
                </button>
            </div>

            <div class="card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>اسم المنتج</th>
                            <th>بيع (DH)</th>
                            <th>شراء (DH)</th>
                            <th>المخزون</th>
                            <th>صافي الربح الكلي</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="myproduct-tbody"></tbody>
                    <tfoot>
                        <tr style="background: #f1f5f9; font-weight: bold;">
                            <td colspan="4">الإجمالي الكلي</td>
                            <td id="total-my-profit">0 DH</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <!-- 4. OBJECTIF SECTION -->
        <section id="objectif" class="page-section">
            <div class="section-header">
                <div class="section-title">
                    <h2>خطط الاستيراد المستقبلية</h2>
                    <p>إدارة الميزانية والكميات المخطط لاستيرادها.</p>
                </div>
                <button class="btn btn-primary" onclick="openObjectifModal()">
                    <i class="ri-add-line"></i> إضافة خطة
                </button>
            </div>

            <div class="card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>اسم المنتج</th>
                            <th>الكمية المستهدفة</th>
                            <th>التكلفة التقديرية ($)</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="objectif-tbody"></tbody>
                    <tfoot>
                        <tr style="background: #f1f5f9; font-weight: bold;">
                            <td>إجمالي الاستثمار</td>
                            <td id="total-obj-qty">0</td>
                            <td id="total-obj-cost">$0</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

    </main>

    <!-- SAVE BUTTON -->
    <div class="save-fab" onclick="saveAllData()">
        <i class="ri-save-3-line"></i>
        حفظ جميع التغييرات
    </div>

    <!-- TOAST -->
    <div id="toast" style="position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 8px; opacity: 0; pointer-events: none; transition: opacity 0.3s;">تم الحفظ بنجاح</div>

    <!-- MODALS -->

    <!-- Simulator Modal -->
    <div class="modal-overlay" id="modal-sim">
        <div class="modal">
            <div class="modal-header">
                <h3>تعديل إعدادات المحاكاة</h3>
                <i class="ri-close-line" style="cursor:pointer; font-size:1.5rem;" onclick="closeModal('modal-sim')"></i>
            </div>
            <div class="form-grid">
                <div class="form-group"><label>شراء (DH)</label><input type="number" class="form-control" id="edit-sim-buy"></div>
                <div class="form-group"><label>استيراد (DH)</label><input type="number" class="form-control" id="edit-sim-import"></div>
                <div class="form-group"><label>توصيل (DH)</label><input type="number" class="form-control" id="edit-sim-delivery"></div>
                <div class="form-group"><label>عمولات (DH)</label><input type="number" class="form-control" id="edit-sim-comm"></div>
                <div class="form-group"><label>إعلانات (DH)</label><input type="number" class="form-control" id="edit-sim-ads"></div>
                <div class="form-group"><label>إعلانات تجريبية (DH)</label><input type="number" class="form-control" id="edit-sim-testads"></div>
                <div class="form-group"><label>سعر البيع (DH)</label><input type="number" class="form-control" id="edit-sim-sell"></div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modal-sim')">إلغاء</button>
                <button class="btn btn-primary" onclick="saveSimSettings()">تحديث الإعدادات</button>
            </div>
        </div>
    </div>

    <!-- Winning Modal (With Auto Calc) -->
    <div class="modal-overlay" id="modal-winning">
        <div class="modal">
            <div class="modal-header">
                <h3 id="winning-modal-title">إضافة منتج فائز</h3>
                <i class="ri-close-line" style="cursor:pointer; font-size:1.5rem;" onclick="closeModal('modal-winning')"></i>
            </div>
            <input type="hidden" id="winning-id">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>اسم المنتج</label>
                <input type="text" class="form-control" id="winning-name">
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>شراء ($)</label>
                    <input type="number" class="form-control" id="winning-buy" oninput="calcWinningPrice()">
                </div>
                <div class="form-group">
                    <label>الربح المطلوب ($)</label>
                    <input type="number" class="form-control" id="winning-profit-target" placeholder="مثلاً: 15" value="15" oninput="calcWinningPrice()">
                </div>
                <div class="form-group">
                    <label>بيع المقترح ($)</label>
                    <input type="number" class="form-control" id="winning-sell" readonly style="background:#f0f9ff; border-color:#bfdbfe;">
                </div>
                <div class="form-group">
                    <label>الحالة</label>
                    <select class="form-control" id="winning-status">
                        <option value="">-- اختر --</option>
                        <option value="Valid">Valid</option>
                        <option value="Invalid">Invalid</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modal-winning')">إلغاء</button>
                <button class="btn btn-primary" onclick="saveWinningProduct()">حفظ المنتج</button>
            </div>
        </div>
    </div>

    <!-- My Product Modal (With Auto Calc) -->
    <div class="modal-overlay" id="modal-myproduct">
        <div class="modal">
            <div class="modal-header">
                <h3 id="myproduct-modal-title">إضافة مخزون</h3>
                <i class="ri-close-line" style="cursor:pointer; font-size:1.5rem;" onclick="closeModal('modal-myproduct')"></i>
            </div>
            <input type="hidden" id="myproduct-id">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>اسم المنتج</label>
                <input type="text" class="form-control" id="myproduct-name">
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>شراء (DH)</label>
                    <input type="number" class="form-control" id="myproduct-buy" oninput="calcMyProductPrice()">
                </div>
                <div class="form-group">
                    <label>الربح المطلوب (DH)</label>
                    <input type="number" class="form-control" id="myproduct-profit-target" placeholder="مثلاً: 50" value="50" oninput="calcMyProductPrice()">
                </div>
                <div class="form-group">
                    <label>بيع المقترح (DH)</label>
                    <input type="number" class="form-control" id="myproduct-sell" readonly style="background:#f0fdf4; border-color:#bbf7d0;">
                </div>
                <div class="form-group">
                    <label>المخزون المتوفر</label>
                    <input type="number" class="form-control" id="myproduct-stock">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modal-myproduct')">إلغاء</button>
                <button class="btn btn-primary" onclick="saveMyProduct()">حفظ المنتج</button>
            </div>
        </div>
    </div>

    <!-- Objectif Modal -->
    <div class="modal-overlay" id="modal-objectif">
        <div class="modal">
            <div class="modal-header">
                <h3 id="objectif-modal-title">خطة استيراد جديدة</h3>
                <i class="ri-close-line" style="cursor:pointer; font-size:1.5rem;" onclick="closeModal('modal-objectif')"></i>
            </div>
            <input type="hidden" id="objectif-id">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label>اسم المنتج</label>
                <input type="text" class="form-control" id="objectif-name">
            </div>
            <div class="form-grid">
                <div class="form-group"><label>الكمية</label><input type="number" class="form-control" id="objectif-qty"></div>
                <div class="form-group"><label>التكلفة ($)</label><input type="number" class="form-control" id="objectif-cost"></div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('modal-objectif')">إلغاء</button>
                <button class="btn btn-primary" onclick="saveObjectif()">حفظ الخطة</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA STATE ---
        const DB_KEY = 'ecommerce_manager_db';
        
        let appData = {
            simulator: { buyPrice: 50, importFees: 10, deliveryFees: 80, commissionFees: 0, adsFees: 50, testAdsFees: 0, sellingPrice: 190 },
            winning: [
                { id: 1715001, name: "USB Plug Kitchen Electric Double Sided Knife Sharpener", buy: 9, sell: 30, status: "Valid" },
                { id: 1715002, name: "Console Blanche de jeu rétro 20 000 jeux", buy: 15, sell: 37, status: "Valid" }
            ],
            myProducts: [
                { id: 1726001, name: "خيمة شاطئية وحمام سباحة للأطفال", sell: 28, buy: 11, stock: 100 },
                { id: 1726002, name: "محول شاشة السيارة إلى كار بلاي", sell: 28, buy: 9.5, stock: 47 }
            ],
            objectifs: [
                { id: 1737001, name: "جهاز طارد الكلاب", qty: 200, cost: 600 },
                { id: 1737002, name: "كاميرا السيارة ب 4 كاميرات", qty: 200, cost: 3110 }
            ]
        };

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderAll();
        });

        function renderAll() {
            renderSimulator();
            renderWinning();
            renderMyProduct();
            renderObjectif();
        }

        // --- NAVIGATION ---
        function navTo(sectionId) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const activeNav = Array.from(document.querySelectorAll('.nav-item')).find(el => el.getAttribute('onclick').includes(sectionId));
            if(activeNav) activeNav.classList.add('active');
        }

        // --- STORAGE ---
        function loadData() {
            const stored = localStorage.getItem(DB_KEY);
            if (stored) appData = JSON.parse(stored);
        }
        function saveAllData() {
            localStorage.setItem(DB_KEY, JSON.stringify(appData));
            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 2000);
        }

        // --- SIMULATOR ---
        function renderSimulator() {
            const s = appData.simulator;
            const totalCost = s.buyPrice + s.importFees + s.deliveryFees + s.commissionFees + s.adsFees + s.testAdsFees;
            const profit = s.sellingPrice - totalCost;
            
            document.getElementById('sim-buy').value = s.buyPrice;
            document.getElementById('sim-total-cost').value = totalCost;
            document.getElementById('sim-sell').value = s.sellingPrice;
            document.getElementById('sim-profit').value = profit;
            document.getElementById('sim-profit').style.color = profit >= 0 ? 'var(--success)' : 'var(--danger)';
        }

        function openSimModal() {
            const s = appData.simulator;
            document.getElementById('edit-sim-buy').value = s.buyPrice;
            document.getElementById('edit-sim-import').value = s.importFees;
            document.getElementById('edit-sim-delivery').value = s.deliveryFees;
            document.getElementById('edit-sim-comm').value = s.commissionFees;
            document.getElementById('edit-sim-ads').value = s.adsFees;
            document.getElementById('edit-sim-testads').value = s.testAdsFees;
            document.getElementById('edit-sim-sell').value = s.sellingPrice;
            document.getElementById('modal-sim').classList.add('open');
        }

        function saveSimSettings() {
            appData.simulator.buyPrice = parseFloat(document.getElementById('edit-sim-buy').value) || 0;
            appData.simulator.importFees = parseFloat(document.getElementById('edit-sim-import').value) || 0;
            appData.simulator.deliveryFees = parseFloat(document.getElementById('edit-sim-delivery').value) || 0;
            appData.simulator.commissionFees = parseFloat(document.getElementById('edit-sim-comm').value) || 0;
            appData.simulator.adsFees = parseFloat(document.getElementById('edit-sim-ads').value) || 0;
            appData.simulator.testAdsFees = parseFloat(document.getElementById('edit-sim-testads').value) || 0;
            appData.simulator.sellingPrice = parseFloat(document.getElementById('edit-sim-sell').value) || 0;
            renderSimulator();
            closeModal('modal-sim');
            saveAllData();
        }

        // --- WINNING PRODUCTS ---
        function renderWinning() {
            const tbody = document.getElementById('winning-tbody');
            tbody.innerHTML = '';
            appData.winning.forEach((item, index) => {
                const badgeClass = item.status === 'Valid' ? 'badge-valid' : (item.status === 'Invalid' ? 'badge-invalid' : '');
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>$${item.buy}</td>
                    <td>$${item.sell}</td>
                    <td><span class="badge ${badgeClass}">${item.status || '-'}</span></td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-sm" onclick="editWinning(${index})"><i class="ri-pencil-line"></i></button>
                            <button class="btn btn-sm btn-danger" onclick="deleteWinning(${index})"><i class="ri-delete-bin-line"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openWinningModal() {
            document.getElementById('winning-modal-title').innerText = "إضافة منتج فائز";
            document.getElementById('winning-id').value = "";
            document.getElementById('winning-name').value = "";
            document.getElementById('winning-buy').value = "";
            document.getElementById('winning-profit-target').value = "15"; // Default profit
            document.getElementById('winning-sell').value = "";
            document.getElementById('winning-status').value = "";
            document.getElementById('modal-winning').classList.add('open');
        }

        function calcWinningPrice() {
            const buy = parseFloat(document.getElementById('winning-buy').value) || 0;
            const profit = parseFloat(document.getElementById('winning-profit-target').value) || 0;
            document.getElementById('winning-sell').value = buy + profit;
        }

        function editWinning(index) {
            const item = appData.winning[index];
            document.getElementById('winning-modal-title').innerText = "تعديل المنتج";
            document.getElementById('winning-id').value = index;
            document.getElementById('winning-name').value = item.name;
            document.getElementById('winning-buy').value = item.buy;
            document.getElementById('winning-profit-target').value = (item.sell - item.buy).toFixed(2);
            document.getElementById('winning-sell').value = item.sell;
            document.getElementById('winning-status').value = item.status;
            document.getElementById('modal-winning').classList.add('open');
        }

        function saveWinningProduct() {
            const id = document.getElementById('winning-id').value;
            const newData = {
                id: id !== "" ? appData.winning[id].id : Date.now(),
                name: document.getElementById('winning-name').value,
                buy: parseFloat(document.getElementById('winning-buy').value) || 0,
                sell: parseFloat(document.getElementById('winning-sell').value) || 0,
                status: document.getElementById('winning-status').value
            };
            if (id !== "") appData.winning[id] = newData;
            else appData.winning.push(newData);
            renderWinning();
            closeModal('modal-winning');
            saveAllData();
        }

        function deleteWinning(index) {
            if(confirm('حذف؟')) { appData.winning.splice(index, 1); renderWinning(); saveAllData(); }
        }

        // --- MY PRODUCT ---
        function renderMyProduct() {
            const tbody = document.getElementById('myproduct-tbody');
            tbody.innerHTML = '';
            let totalProfit = 0;
            appData.myProducts.forEach((item, index) => {
                const profit = (item.sell - item.buy) * item.stock;
                totalProfit += profit;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.sell}</td>
                    <td>${item.buy}</td>
                    <td>${item.stock}</td>
                    <td style="font-weight:bold; color:${profit>=0?'var(--success)':'var(--danger)'}">${profit.toFixed(1)} DH</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-sm" onclick="editMyProduct(${index})"><i class="ri-pencil-line"></i></button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMyProduct(${index})"><i class="ri-delete-bin-line"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            document.getElementById('total-my-profit').innerText = totalProfit.toLocaleString() + ' DH';
        }

        function openMyProductModal() {
            document.getElementById('myproduct-modal-title').innerText = "إضافة مخزون";
            document.getElementById('myproduct-id').value = "";
            document.getElementById('myproduct-name').value = "";
            document.getElementById('myproduct-buy').value = "";
            document.getElementById('myproduct-profit-target').value = "50"; // Default profit
            document.getElementById('myproduct-sell').value = "";
            document.getElementById('myproduct-stock').value = "";
            document.getElementById('modal-myproduct').classList.add('open');
        }

        function calcMyProductPrice() {
            const buy = parseFloat(document.getElementById('myproduct-buy').value) || 0;
            const profit = parseFloat(document.getElementById('myproduct-profit-target').value) || 0;
            document.getElementById('myproduct-sell').value = buy + profit;
        }

        function editMyProduct(index) {
            const item = appData.myProducts[index];
            document.getElementById('myproduct-modal-title').innerText = "تعديل المخزون";
            document.getElementById('myproduct-id').value = index;
            document.getElementById('myproduct-name').value = item.name;
            document.getElementById('myproduct-buy').value = item.buy;
            document.getElementById('myproduct-profit-target').value = (item.sell - item.buy).toFixed(2);
            document.getElementById('myproduct-sell').value = item.sell;
            document.getElementById('myproduct-stock').value = item.stock;
            document.getElementById('modal-myproduct').classList.add('open');
        }

        function saveMyProduct() {
            const id = document.getElementById('myproduct-id').value;
            const newData = {
                id: id !== "" ? appData.myProducts[id].id : Date.now(),
                name: document.getElementById('myproduct-name').value,
                sell: parseFloat(document.getElementById('myproduct-sell').value) || 0,
                buy: parseFloat(document.getElementById('myproduct-buy').value) || 0,
                stock: parseFloat(document.getElementById('myproduct-stock').value) || 0
            };
            if (id !== "") appData.myProducts[id] = newData;
            else appData.myProducts.push(newData);
            renderMyProduct();
            closeModal('modal-myproduct');
            saveAllData();
        }

        function deleteMyProduct(index) {
            if(confirm('حذف؟')) { appData.myProducts.splice(index, 1); renderMyProduct(); saveAllData(); }
        }

        // --- OBJECTIF ---
        function renderObjectif() {
            const tbody = document.getElementById('objectif-tbody');
            tbody.innerHTML = '';
            let totalQty = 0, totalCost = 0;
            appData.objectifs.forEach((item, index) => {
                totalQty += parseInt(item.qty);
                totalCost += parseFloat(item.cost);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.qty}</td>
                    <td>$${item.cost}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-sm" onclick="editObjectif(${index})"><i class="ri-pencil-line"></i></button>
                            <button class="btn btn-sm btn-danger" onclick="deleteObjectif(${index})"><i class="ri-delete-bin-line"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            document.getElementById('total-obj-qty').innerText = totalQty;
            document.getElementById('total-obj-cost').innerText = '$' + totalCost.toLocaleString();
        }

        function openObjectifModal() {
            document.getElementById('objectif-modal-title').innerText = "خطة استيراد جديدة";
            document.getElementById('objectif-id').value = "";
            document.getElementById('objectif-name').value = "";
            document.getElementById('objectif-qty').value = "";
            document.getElementById('objectif-cost').value = "";
            document.getElementById('modal-objectif').classList.add('open');
        }

        function editObjectif(index) {
            const item = appData.objectifs[index];
            document.getElementById('objectif-modal-title').innerText = "تعديل الخطة";
            document.getElementById('objectif-id').value = index;
            document.getElementById('objectif-name').value = item.name;
            document.getElementById('objectif-qty').value = item.qty;
            document.getElementById('objectif-cost').value = item.cost;
            document.getElementById('modal-objectif').classList.add('open');
        }

        function saveObjectif() {
            const id = document.getElementById('objectif-id').value;
            const newData = {
                id: id !== "" ? appData.objectifs[id].id : Date.now(),
                name: document.getElementById('objectif-name').value,
                qty: parseInt(document.getElementById('objectif-qty').value) || 0,
                price: parseFloat(document.getElementById('objectif-cost').value) || 0 // Typo fix in logic, using cost below
            };
            newData.cost = parseFloat(document.getElementById('objectif-cost').value) || 0; // Fix cost logic
            
            if (id !== "") appData.objectifs[id] = newData;
            else appData.objectifs.push(newData);
            renderObjectif();
            closeModal('modal-objectif');
            saveAllData();
        }

        function deleteObjectif(index) {
            if(confirm('حذف؟')) { appData.objectifs.splice(index, 1); renderObjectif(); saveAllData(); }
        }

        // --- UTILS ---
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
        window.onclick = function(event) { if (event.target.classList.contains('modal-overlay')) event.target.classList.remove('open'); }
    </script>
</body>
</html>
